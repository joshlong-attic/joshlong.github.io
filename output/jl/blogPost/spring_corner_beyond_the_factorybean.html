<!DOCTYPE html>
<html lang="en">
  <head>


<meta name="google-site-verification" content="HJPICnDuSD1SEs3EspTr7FdQIAOWIoI7E8nW-C5GSHk" />

    <meta charset="utf-8"/>
    <title>Spring Corner: Beyond the FactoryBean</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">
    <link rel="alternate" type="application/rss+xml" title="Feed for JoshLong.com" href="feed.xml" />
    <link rel="alternate feed" type="application/rss+xml" title="Feed for JoshLong.com" href="feed.xml">
 
    <!-- Le styles -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">
	
<style type="text/css">
/* .navbar-brand img {
 height : 80px ;
 border: 1px solid grey ;
 padding :10px;
 background-color: white ;
}*/


</style>
	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
<a class="navbar-brand" href="../../">
 	<span style="font-size:larger;font-weight :bold;">
	Josh Long's Blog
	</span> </a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../../index.html">Home</a></li>
            <li><a href="../../about.html">About</a></li>
            <li><a href="../../abstracts.html">Abstracts</a></li>
            <li><a href="../../livelessons.html">Livelessons</a></li>
            <li><a href="../../feed.xml"><img src="https://www.w3schools.com/xml/pic_rss.gif" width="36" height="14"></a></li>

          </ul>
        </div>
      </div>
    </div>
    <div class="container">
	
	<div class="page-header">
		<h1>Spring Corner: Beyond the FactoryBean</h1>
	</div>

	<p><em>23 July 2011</em></p>

	<p><div style="padding:10px; background-color:#999; ">
  I've decided I'm going to try to write up a series of small posts on things about Spring that are perhaps common knowledge, but helpful to know, anyway. These posts are geared decidedly towards newcomers, though old hats might learn a thing or two. 
</div> 
<p> I looked at what a basic <code>FactoryBean</code> is in my previous post. While <code>FactoryBeans</code> are important - and knowing what they do can help you navigate the framework - they're by and large no longer the recommended approach to the task as of Spring 3.0 and the imminent Spring 3.1. </p> 
<p> The whole point of a <code>FactoryBean</code> is to hide the construction of an object - either because it's very complex or because it can't simply be instantiated using that typical constructor-centric approach used by the Spring container (Maybe it needs to be looked up? Maybe it needs a static registry method?) </p> 
<p> Spring 3.0 saw the introduction of Java configuration which lets you define beans using Java. For instance, to register a regular <code>javax.sql.DataSource</code> with Spring in XML, you will more than likely delegate to a properties file for the sensitive configuration information (like a database password) and use Spring to instantiate the <code>javax.sql.DataSource</code>, like this: </p> 
<pre> 
&lt;beans ...&gt;
	&lt;context:property-placeholder location = "<b>ds.properties</b>" /&gt;
	
	&lt;bean id = "<b>ds</b>" class = "<b>a.b.c.MySqlDataSource</b>"&gt;
	  &lt;property name = "user" value = "${<b>ds.user</b>}"/&gt;
	  &lt;property name = "password" value = "${<b>ds.password</b>}"/&gt;
	&lt;/bean&gt;
&lt;/beans&gt;
</pre> 
<p> This is a simple bean, and translates naturally into Java configuration. It would look like this: </p> 
<pre>
import a.b.c.* ;
	
@Configuration 
@PropertySource("<b>ds.properties</b>") 
public class MyConfiguration { 
    @Inject private Environment env ; 
	
    @Bean public <b>MySqlDataSource</b> <b>ds</b>(){ 
        MySqlDataSource ds = new MySqlDataSource() ; 
        ds.setUser( env.getProperty("<b>ds.user</b>") );
        ds.setPassword( env.getProperty("<b>ds.password</b>"));
        return ds; 
    }
}
</pre> 
<p> The beauty of this is that you're free to do anything you'd like inside the method. The return value is what's registered in the Spring container. Anything you do in service of properly constructing this object is up to you - you're no longer bound by the limits of what Spring can instantiate based on the XML specified. And, this is more natural - it's far easier to guarantee there's no typos using Java than XML. So, take away from this that Java configuration is - about equal in terms of lines of code, but a lot more powerful, and conceptually more natural. </p> 
<p> With those limitations lifted, the value of the <code>FactoryBean</code> is starting to lessen. After all, if all a <code>FactoryBean</code> does is encode construction logic in a novel or unique way, then there's no reason that couldn't be done inside a Java configuration method, is there? Let's revisit the example from the last blog post, a custom <code>FactoryBean</code> designed to factory cars. </p> 
<pre>
public class MyCarFactoryBean implements FactoryBean&lt;Car&gt; {
  private String mark; 
  private int year ;
  public void setMark(String m){ this.mark =m ; }
  public void setYear(int y){ this.year = y; }
  public Car getObject(){ 
    // wouldn't be a very useful FactoryBean 
    // if we could simply instantiate the object ;-)
    CarBuilder cb = CarBuilder.car();
	
    if(year!=0) cb.setYear(this.year);
    if(StringUtils.hasText(this.mark)) cb.setMark( this.mark); 
    return cb.factory(); 
  }
  public Class
 <car>
   getObjectType() { return Car.class ; } 
  public boolean isSingleton() { return false; }
} 

 </car></pre> 
<p> In this example, we only conditionally set values if there are values to be set. So, we do some dancing around to ensure that we have values. This code is ugly, because it has a lot of different execution paths, but it's not particularly novel. We're adults, we can do this sort of thing ourselves. Let's dispose of the <code>FactoryBean</code> and simply use Java configuration to replace it for a definition of a <code>Car</code>. Again, we happen to know what configuratoin we need, so we don't have to duplicate the null checks in our code. </p> 
<pre>
@Bean public Car honda(){ 
	return CarBuilder.car()
	.setYear( 1984 )
	.setMark("Honda")
	.factory(); 
}
</pre> 
<p> Not bad! We no longer need the complex <code>FactoryBean</code>, and we have a usable bean definition. If we wanted to make this reusable, we could, as well, by simply creating a factory method, like this: </p> 
<pre>
// presumably exposed from some place where other configuration classes can reuse it.
public Car buildCar(int year, String make){ 
    CarBuilder cb = CarBuilder.car();
    if(year!=0) cb.setYear( year);
    if(StringUtils.hasText( mark)) cb.setMark( mark); 
    return cb.factory();
}
...
// now the Spring definition itself is even simpler, <em>and</em> it's reusable!
@Bean public Car honda() {
	return car(1984, "Honda") ;
}
</pre> 
<p> In Spring 3.1, there are many places where Spring also provides a <em>Builder</em> alternative to a <code>FactoryBean</code>. A Builder, as a pattern, is conceptually simialar to a <code>FactoryBean</code>. In practice, however, they are usually exposed like the <code>CarBuilder</code> demonstrated above. They are typically chainable - a method returns <code>this</code> and so subsequent invocations don't need to dereference the object, they can continue <em>chaining</em> invocations. Additionally, a Builder usually does the null pointer checks that I forced in the previous code. So, a properly rewritten <code>CarBuilder</code> object usage might look like this: </p> 
<pre>
@Bean public Car honda(){ 
 return CarBuilder.car()
  // doesn't matter if the parameters are null - 
  // it'll validate in the <b>factory()</b> method
  .setYear( 1984 )  
  .setMark( "Honda" )
  .factory();
}
</pre> 
<p>A great example of a builder providing a much smoother experience in 3.1 over Spring's <code>FactoryBean</code>s is the new Hibernate 3 <code>SessionFactoryBuilder</code>, whose usage looks like this: </p> 
<pre>
		
@Configuration  
@EnableTransactionManagment 
public class ServiceConfiguration {  
	
  @Bean public javax.sql.DataSource dataSource(){ ... }
  @Bean public SessionFactory hibernate3SessionFactory(){ 
     return new AnnotationSessionFactoryBuilder()
 	     .setDataSource(dataSource())
 	     // you could do this:
 	     //.setAnnotatedClasses( Customer.class, LineItem.class, Order.class )
 	     // or simply scan a package where your entities live
 	     .setAnnotatedPackages( Customer.class.getPackage().getName()) 
 	     .buildSessionFactory();
 }
}
</pre> 
<p>The equivalent <code>FactoryBean</code>s now delegate to these builder classes, in fact! </p></p>

	<hr />
	
		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2018 JoshLong.com </p>
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../js/jquery-1.11.1.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/prettify.js"></script>

  </body>
</html>
